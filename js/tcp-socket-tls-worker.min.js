/*! Copyright Â© 2015, Whiteout Project.*/

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(){"use strict";function b(a){self.postMessage(h(o,a))}function c(a){self.postMessage(h(m,a))}function d(){self.postMessage(h(l))}function e(){self.postMessage(h(k))}function f(a){self.postMessage(h(j,a),[a])}function g(a){self.postMessage(h(i,a),[a])}function h(a,b){return{event:a,message:b}}var i="inbound",j="outbound",k="open",l="close",m="error",n="configure",o="cert",p="handshake";importScripts("forge.min.js");var q=a("./tcp-socket-tls"),r=new q;r.tlserror=c,r.tlscert=b,r.tlsclose=d,r.tlsopen=e,r.tlsoutbound=f,r.tlsinbound=g,self.onmessage=function(a){var b=a.data.event,c=a.data.message;switch(b){case i:r.processInbound(c);break;case j:r.prepareOutbound(c);break;case p:r.handshake();break;case n:r.configure(c)}}}()},{"./tcp-socket-tls":2}],2:[function(a,b,c){!function(a,d){"use strict";"function"==typeof define&&define.amd?define(["forge"],d):"object"==typeof c&&"undefined"!=typeof navigator?b.exports=d(forge):a.TLS=d(a.forge)}(this,function(a){"use strict";function b(a){for(var b=new Uint8Array(a),c="",d=0,e=b.length;e>d;d++)c+=String.fromCharCode(b[d]);return c}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;d>c;c++)b[c]=a.charCodeAt(c);return b.buffer}var d=function(){var b=this;b.open=!1,b._outboundBuffer=[],b._tls=a.tls.createConnection({server:!1,verify:function(c,d,e,f){if(!f||!f[0])return!1;if(!b.verifyCertificate(f[0],b._host))return!1;if(!b._ca)return b.tlscert(a.pki.certificateToPem(f[0])),!0;if(!b.verifyCertificate(b._ca,b._host))return b._ca.verify(f[0]);var g=a.pki.getPublicKeyFingerprint(b._ca.publicKey,{encoding:"hex"}),h=a.pki.getPublicKeyFingerprint(f[0].publicKey,{encoding:"hex"});return g===h?!0:(b.tlscert(a.pki.certificateToPem(f[0])),!1)},connected:function(a){if(!a)return b.tlserror("Unable to connect"),void b.tlsclose();for(b.open=!0,b.tlsopen();b._outboundBuffer.length;)b.prepareOutbound(b._outboundBuffer.shift())},tlsDataReady:function(a){b.tlsoutbound(c(a.tlsData.getBytes()))},dataReady:function(a){b.tlsinbound(c(a.data.getBytes()))},closed:function(){b.tlsclose()},error:function(a,c){b.tlserror(c.message),b.tlsclose()}})};return d.prototype.configure=function(b){this._host=b.host,b.ca&&(this._ca=a.pki.certificateFromPem(b.ca))},d.prototype.prepareOutbound=function(a){return this.open?void this._tls.prepare(b(a)):void this._outboundBuffer.push(a)},d.prototype.processInbound=function(a){this._tls.process(b(a))},d.prototype.handshake=function(){this._tls.handshake()},d.prototype.verifyCertificate=function(a,b){var c,d,e,f=this;if(d=a.getExtension({name:"subjectAltName"}),c=a.subject.getField("CN"),d&&d.altNames&&d.altNames.length)e=d.altNames.map(function(a){return a.value});else{if(!c||!c.value)return!1;e=[c.value]}return!!e.filter(function(a){return f.compareServername(b,a)}).length},d.prototype.compareServername=function(a,b){return a=(a||"").toString().toLowerCase(),b=(b||"").toString().toLowerCase(),"*."!==b.substr(0,2)?b===a:a.split(".").slice(1).join(".")===b.substr(2)},d})},{}]},{},[1]);
//# sourceMappingURL=tcp-socket-tls-worker.min.js.map